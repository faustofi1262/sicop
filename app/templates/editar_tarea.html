
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Editar Tarea</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script>
        function numeroALetras(numero) {
            return new Intl.NumberFormat('es-EC', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 2
            }).format(numero).replace('$', '').replace('USD', '').trim();
        }

        function calcularYConvertir() {
            const sinIva = parseFloat(document.querySelector('input[name="valor_sin_iva"]').value) || 0;
            const exento = parseFloat(document.querySelector('input[name="valor_exento"]').value) || 0;
            const total = sinIva + exento;

            fetch(`/convertir_a_letras?valor=${total}`)
                .then(response => response.text())
                .then(texto => {
                    document.querySelector('input[name="valor_en_letras"]').value = texto;
                });
        }

        document.addEventListener("DOMContentLoaded", function() {
            document.querySelector('input[name="valor_sin_iva"]').addEventListener("input", calcularYConvertir);
            document.querySelector('input[name="valor_exento"]').addEventListener("input", calcularYConvertir);
        });
    </script>
</head>
<body class="container py-4">
    <h2 class="text-primary mb-4">✏️ Editar Tarea</h2>

    <form method="POST">
        <div class="form-group">
            <label>Funcionario Encargado:</label>
            <input type="text" name="funcionario_encargado" class="form-control form-control-sm" value="{{ tarea[2] }}" required>
        </div>

        <div class="form-row">
            <div class="col">
                <label>Tipo de Proceso:</label>
                <select name="tipo_proceso" class="form-control form-control-sm" required>
                    <option value="">-- Seleccione --</option>
                    {% for tipo in tipos_proceso %}
                        <option value="{{ tipo[0] }}" {% if tarea[3] == tipo[0] %}selected{% endif %}>{{ tipo[0] }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col">
                <label>Estado del Requerimiento:</label>
                <input type="text" name="estado_requerimiento" class="form-control form-control-sm" value="{{ tarea[4] }}">
            </div>
        </div>

        <label class="mt-2">Objeto de la Contratación:</label>
        <textarea name="objeto_contratacion" class="form-control">{{ tarea[5] }}</textarea>

        <div class="form-row mt-2">
            <div class="col">
                <label>Código del Proceso:</label>
                <input type="text" name="codigo_proceso" class="form-control form-control-sm" value="{{ tarea[6] }}">
            </div>
            <div class="col">
                <label>Fecha de Recepción:</label>
                <input type="date" name="fecha_recepcion" class="form-control form-control-sm" value="{{ tarea[7] }}">
            </div>
        </div>

        <div class="form-row mt-2">
            <div class="col">
                <label>Valor sin IVA:</label>
                <input type="number" name="valor_sin_iva" step="0.01" class="form-control form-control-sm" value="{{ tarea[8] }}">
            </div>
            <div class="col">
                <label>Valor Exento:</label>
                <input type="number" name="valor_exento" step="0.01" class="form-control form-control-sm" value="{{ tarea[9] }}">
            </div>
        </div>

        <label class="mt-2">Valor en Letras:</label>
        <input type="text" name="valor_en_letras" class="form-control form-control-sm" value="{{ tarea[10] }}">

        <label class="mt-2">Tipo de Proceso a Aplicar:</label>
        <input type="text" name="tipo_proceso_aplicar" class="form-control form-control-sm" value="{{ tarea[11] }}">

        <label class="mt-2">Base Legal:</label>
        <input type="text" name="base_legal" class="form-control form-control-sm" value="{{ tarea[12] }}">

        <label class="mt-2">Observaciones:</label>
        <textarea name="observaciones" class="form-control">{{ tarea[13] }}</textarea>

        <div class="form-row mt-2">
            <div class="col">
                <label>Fecha Envío Observaciones:</label>
                <input type="date" name="fecha_envio_observaciones" class="form-control form-control-sm" value="{{ tarea[14] or '' }}">
            </div>
            <div class="col">
                <label>Fecha Corrección Observaciones:</label>
                <input type="date" name="fecha_correccion_observacion" class="form-control form-control-sm" value="{{ tarea[15] or '' }}">
            </div>
        </div>

        <label class="mt-2">Nombre del Jefe de Compras:</label>
        <input type="text" name="nombre_jefe_compras" class="form-control form-control-sm" value="{{ tarea[16] }}">

        <label class="mt-2">Unidad Solicitante:</label>
        <input type="text" name="unidad_solicitante" class="form-control form-control-sm" value="{{ tarea[17] or ''  }}">

        <label class="mt-2">Administrador del Contrato:</label>
        <input type="text" name="administrador_contrato" class="form-control form-control-sm" value="{{ tarea[18] or '' }}">

        <h5 class="mt-4 text-primary font-weight-bold">✅ Verificación de Documentos</h5>
        <div class="form-row">
            <div class="col-md-4">
                <input class="form-check-input" type="checkbox" name="Estudio Previo" {% if tarea[29] %}checked{% endif %}>
                <label class="form-check-label">Estudio Previo</label>
                <input class="form-check-input" type="checkbox" name="Términos de Referencia" {% if tarea[30] %}checked{% endif %}>
                <label class="form-check-label">Términos de Referencia</label>
                <input class="form-check-input" type="checkbox" name="Estudio de Mercado" {% if tarea[31] %}checked{% endif %}>
                <label class="form-check-label">Estudio de Mercado</label>
                <input class="form-check-input" type="checkbox" name="En Catálogo Electrónico" {% if tarea[32] %}checked{% endif %}>
                <label class="form-check-label">En Catálogo Electrónico</label>
                <input class="form-check-input" type="checkbox" name="En el PAC" {% if tarea[33] %}checked{% endif %}>
                <label class="form-check-label">En el PAC</label>
        </div>
            <div class="col-md-4">
                <input class="form-check-input" type="checkbox" name="Especificaciones Técnicas" {% if tarea[33] %}checked{% endif %}>
                <label class="form-check-label">Especificaciones Técnicas</label>
                <input class="form-check-input" type="checkbox" name="Presenta Proformas" {% if tarea[33] %}checked{% endif %}>
                <label class="form-check-label">Presenta Proformas</label>
                <input class="form-check-input" type="checkbox" name="Determinación de la Necesidad" {% if tarea[33] %}checked{% endif %}>
                <label class="form-check-label">Determinación de la Necesidad</label>
                <input class="form-check-input" type="checkbox" name="Catalogado Incluido GNE" {% if tarea[33] %}checked{% endif %}>
                <label class="form-check-label">Catalogado Incluido GNE</label>
        </div>
            <div class="col-md-4">
                <input class="form-check-input" type="checkbox" name="Presenta Errores" {% if tarea[33] %}checked{% endif %}>
                <label class="form-check-label">Presenta Errores</label>
                <input class="form-check-input" type="checkbox" name="Cumple Normativa" {% if tarea[33] %}checked{% endif %}>
                <label class="form-check-label">Cumple Normativa</label>
        </div>

        <button type="submit" class="btn btn-success mt-4">Guardar Cambios</button>
        <a href="/admin/tareas" class="btn btn-secondary mt-4 ml-2">Cancelar</a>
    </form>
</body>
</html>
